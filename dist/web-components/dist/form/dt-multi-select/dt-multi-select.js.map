{"version":3,"file":"dt-multi-select.js","sources":["../../../src/components/form/dt-multi-select/dt-multi-select.js"],"sourcesContent":["import { html, css } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { msg } from '@lit/localize';\nimport DtFormBase from '../dt-form-base.js';\nimport {HasOptionsList} from '../mixins/hasOptionsList.js';\nimport '../../icons/dt-spinner.js';\nimport '../../icons/dt-checkmark.js';\n\nexport class DtMultiSelect extends HasOptionsList(DtFormBase) {\n  static get styles() {\n    return [\n      ...super.styles,\n      css`\n        :host {\n          position: relative;\n          font-family: Helvetica, Arial, sans-serif;\n        }\n\n        .input-group {\n          color: var(--dt-multi-select-text-color, #0a0a0a);\n          margin-bottom: 1rem;\n        }\n        .input-group.disabled input,\n        .input-group.disabled .field-container {\n          background-color: var(--disabled-color);\n        }\n        .input-group.disabled a,\n        .input-group.disabled button {\n          cursor: not-allowed;\n          pointer-events: none;\n        }\n        .input-group.disabled *:hover {\n          cursor: not-allowed;\n        }\n\n        .field-container {\n          background-color: var(--dt-multi-select-background-color, #fefefe);\n          border: 1px solid var(--dt-form-border-color, #cacaca);\n          border-radius: 0;\n          color: var(--dt-multi-select-text-color, #0a0a0a);\n          font-size: 1rem;\n          font-weight: 300;\n          min-height: 2.5rem;\n          line-height: 1.5;\n          margin: 0;\n          padding-top: calc(0.5rem - 0.375rem);\n          padding-bottom: 0.5rem;\n          padding-inline: 0.5rem 1.6rem;\n          box-sizing: border-box;\n          width: 100%;\n          text-transform: none;\n          display: flex;\n          flex-wrap: wrap;\n        }\n\n        .field-container input,\n        .field-container .selected-option {\n          height: 1.25rem;\n        }\n\n        .selected-option {\n          border: 1px solid var(--dt-multi-select-tag-border-color, #c2e0ff);\n          background-color: var(\n            --dt-multi-select-tag-background-color,\n            #c2e0ff\n          );\n\n          display: flex;\n          font-size: 0.875rem;\n          position: relative;\n          border-radius: 2px;\n          margin-inline-end: 4px;\n          margin-block-start: 0.375rem;\n          box-sizing: border-box;\n        }\n        .selected-option > *:first-child {\n          padding-inline-start: 4px;\n          text-overflow: ellipsis;\n          overflow: hidden;\n          white-space: nowrap;\n          --container-padding: calc(0.5rem + 1.6rem + 2px);\n          --option-padding: 8px;\n          --option-button: 20px;\n          max-width: calc(\n            var(--container-width) - var(--container-padding) -\n              var(--option-padding) - var(--option-button)\n          );\n        }\n        .selected-option * {\n          align-self: center;\n        }\n        .selected-option button {\n          background: transparent;\n          outline: 0;\n          border: 0;\n          border-inline-start: 1px solid\n            var(--dt-multi-select-tag-border-color, #c2e0ff);\n          color: var(--dt-multi-select-text-color, #0a0a0a);\n          margin-inline-start: 4px;\n        }\n        .selected-option button:hover {\n          cursor: pointer;\n        }\n\n        .field-container input {\n          background-color: var(--dt-form-background-color, #fff);\n          color: var(--dt-form-text-color, #000);\n          flex-grow: 1;\n          min-width: 50px;\n          border: 0;\n          margin-block-start: 0.375rem;\n        }\n        .field-container input:focus,\n        .field-container input:focus-visible,\n        .field-container input:active {\n          border: 0;\n          outline: 0;\n        }\n        .field-container input::placeholder {\n          color: var(--dt-text-placeholder-color, #999);\n          opacity: 1;\n        }\n\n        /* === Options List === */\n        .option-list {\n          list-style: none;\n          margin: 0;\n          padding: 0;\n          border: 1px solid var(--dt-form-border-color, #cacaca);\n          background: var(--dt-form-background-color, #fefefe);\n          z-index: 10;\n          position: absolute;\n          width: 100%;\n          top: 0;\n          left: 0;\n          box-shadow: var(--shadow-1);\n          max-height: 150px;\n          overflow-y: scroll;\n        }\n        .option-list li {\n          border-block-start: 1px solid var(--dt-form-border-color, #cacaca);\n          outline: 0;\n        }\n        .option-list li div,\n        .option-list li button {\n          padding: 0.5rem 0.75rem;\n          color: var(--dt-multi-select-text-color, #0a0a0a);\n          font-weight: 100;\n          font-size: 1rem;\n          text-decoration: none;\n          text-align: inherit;\n        }\n        .option-list li button {\n          display: block;\n          width: 100%;\n          border: 0;\n          background: transparent;\n        }\n        .option-list li button:hover,\n        .option-list li button.active {\n          cursor: pointer;\n          background: var(--dt-multi-select-option-hover-background, #f5f5f5);\n        }\n      `,\n    ];\n  }\n\n  static get properties() {\n    return {\n      ...super.properties,\n      placeholder: { type: String },\n      containerHeight: {\n        type: Number,\n        state: true,\n      },\n      onchange: { type: String },\n    };\n  }\n\n  _select(value) {\n    // Create custom event with new/old values to pass to onchange function\n    const event = new CustomEvent('change', {\n      bubbles: true,\n      detail: {\n        field: this.name,\n        oldValue: this.value,\n      },\n    });\n\n    // update value in this component\n    if (this.value && this.value.length) {\n      if (typeof this.value[0] === 'string') {\n        // If value is array of strings, check for same value prefixed with hyphen\n        this.value = [...this.value.filter(i => i !== `-${value}`), value];\n      } else {\n        // If value is array of objects, check for same value with `delete` property\n        let foundPrevious = false;\n        const newVal = this.value.map(i => {\n          const val = {\n            ...i,\n          };\n          if (i.id === value.id && i.delete) {\n            delete val.delete;\n            foundPrevious = true;\n          }\n          return val;\n        });\n        if (!foundPrevious) {\n          newVal.push(value);\n        }\n        this.value = newVal;\n      }\n    } else {\n      this.value = [value];\n    }\n    event.detail.newValue = this.value;\n    this.open = false; // close options list\n    this.activeIndex = -1; // reset keyboard-selected option\n\n    // dispatch event for use with addEventListener from javascript\n    this.dispatchEvent(event);\n    this._setFormValue(this.value);\n  }\n\n  _remove(e) {\n    if (e.target && e.target.dataset && e.target.dataset.value) {\n      const event = new CustomEvent('change', {\n        bubbles: true,\n        detail: {\n          field: this.name,\n          oldValue: this.value,\n        },\n      });\n      this.value = (this.value || []).map(i =>\n        i === e.target.dataset.value ? `-${i}` : i\n      );\n      event.detail.newValue = this.value;\n\n      // dispatch event for use with addEventListener from javascript\n      this.dispatchEvent(event);\n      this._setFormValue(this.value);\n\n      // If option was de-selected while list was open, re-focus input\n      if (this.open) {\n        this.shadowRoot.querySelector('input').focus();\n      }\n    }\n  }\n\n  /**\n   * Filter to options that:\n   *   1: are not selected\n   *   2: match the search query\n   * @private\n   */\n  _filterOptions() {\n    this.filteredOptions = (this.options || []).filter(\n      opt =>\n        !(this.value || []).includes(opt.id) &&\n        (!this.query ||\n          opt.label\n            .toLocaleLowerCase()\n            .includes(this.query.toLocaleLowerCase()))\n    );\n    return this.filteredOptions;\n  }\n\n  willUpdate(props) {\n    super.willUpdate(props);\n\n    if (props) {\n      const valueChanged = props.has('value');\n      const queryChanged = props.has('query');\n      const optionsChanged = props.has('options');\n\n      // if value, query, or options change, trigger filter\n      if (valueChanged || queryChanged || optionsChanged) {\n        this._filterOptions();\n      }\n    }\n  }\n\n  _renderSelectedOptions() {\n    return (\n      this.options &&\n      this.options\n        .filter(opt => this.value && this.value.indexOf(opt.id) > -1)\n        .map(\n          opt => html`\n            <div class=\"selected-option\">\n              <span>${opt.label}</span>\n              <button\n                @click=\"${this._remove}\"\n                ?disabled=\"${this.disabled}\"\n                data-value=\"${opt.id}\"\n              >\n                x\n              </button>\n            </div>\n          `\n        )\n    );\n  }\n\n  render() {\n    const optionListStyles = {\n      display: this.open ? 'block' : 'none',\n      top: this.containerHeight ? `${this.containerHeight}px` : '2.5rem',\n    };\n    return html`\n      ${this.labelTemplate()}\n\n      <div class=\"input-group ${this.disabled ? 'disabled' : ''}\">\n        <div\n          class=\"field-container\"\n          @click=\"${this._focusInput}\"\n          @keydown=\"${this._focusInput}\"\n        >\n          ${this._renderSelectedOptions()}\n          <input\n            type=\"text\"\n            placeholder=\"${this.placeholder}\"\n            @focusin=\"${this._inputFocusIn}\"\n            @blur=\"${this._inputFocusOut}\"\n            @keydown=\"${this._inputKeyDown}\"\n            @keyup=\"${this._inputKeyUp}\"\n            ?disabled=\"${this.disabled}\"\n          />\n        </div>\n        <ul class=\"option-list\" style=${styleMap(optionListStyles)}>\n          ${this._renderOptions()}\n        </ul>\n        ${this.loading\n          ? html`<dt-spinner class=\"icon-overlay\"></dt-spinner>`\n          : null}\n        ${this.saved\n          ? html`<dt-checkmark class=\"icon-overlay success\"></dt-checkmark>`\n          : null}\n        ${this.error\n          ? html`<dt-icon\n                icon=\"mdi:alert-circle\"\n                class=\"icon-overlay alert\"\n                tooltip=\"${this.error}\"\n                size=\"2rem\"\n                ></dt-icon>`\n              : null}\n        </div>\n`;\n  }\n}\n\nwindow.customElements.define('dt-multi-select', DtMultiSelect);\n"],"names":["DtMultiSelect","HasOptionsList","DtFormBase","styles","super","css","properties","placeholder","type","String","containerHeight","Number","state","onchange","_select","value","event","CustomEvent","bubbles","detail","field","this","name","oldValue","length","filter","i","foundPrevious","newVal","map","val","id","delete","push","newValue","open","activeIndex","dispatchEvent","_setFormValue","_remove","e","target","dataset","shadowRoot","querySelector","focus","_filterOptions","filteredOptions","options","opt","includes","query","label","toLocaleLowerCase","willUpdate","props","valueChanged","has","queryChanged","optionsChanged","_renderSelectedOptions","indexOf","html","disabled","render","optionListStyles","display","top","labelTemplate","_focusInput","_inputFocusIn","_inputFocusOut","_inputKeyDown","_inputKeyUp","styleMap","_renderOptions","loading","saved","error","window","customElements","define"],"mappings":"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"}