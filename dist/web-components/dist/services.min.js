var WebComponentServices=function(t){"use strict";class e{constructor(t,e="nextdttheme/wp-json"){this.nonce=t,this.apiRoot=e.endsWith("/")?`${e}`:`${e} + "/"`,this.apiRoot=`/${e}/`.replace(/\/\//g,"/")}async makeRequest(t,e,s,a="dt/v1/"){let n=a;n.endsWith("/")||e.startsWith("/")||(n+="/");const o=e.startsWith("http")?e:`${this.apiRoot}${n}${e}`,r={method:t,credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce}};"GET"!==t&&(r.body=JSON.stringify(s));const i=await fetch(o,r),c=await i.json();if(!i.ok){const t=new Error(c?.message||c.toString());throw t.args={status:i.status,statusText:i.statusText,body:c},t}return c}async makeRequestOnPosts(t,e,s={}){return this.makeRequest(t,e,s,"dt-posts/v2/")}async getPost(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}`)}async createPost(t,e){return this.makeRequestOnPosts("POST",t,e)}async updatePost(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}`,s)}async deletePost(t,e){return this.makeRequestOnPosts("DELETE",`${t}/${e}`)}async listPostsCompact(t,e=""){const s=new URLSearchParams({s:e});return this.makeRequestOnPosts("GET",`${t}/compact?${s}`)}async getPostDuplicates(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/all_duplicates`,s)}async getMultiSelectValues(t,e,s=""){const a=new URLSearchParams({s,field:e});return this.makeRequestOnPosts("GET",`${t}/multi-select-values?${a}`)}async transferContact(t,e){return this.makeRequestOnPosts("POST","contacts/transfer",{contact_id:t,site_post_id:e})}async transferContactSummaryUpdate(t,e){return this.makeRequestOnPosts("POST","contacts/transfer/summary/send-update",{contact_id:t,update:e})}async requestRecordAccess(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}/request_record_access`,{user_id:s})}async createComment(t,e,s,a="comment"){return this.makeRequestOnPosts("POST",`${t}/${e}/comments`,{comment:s,comment_type:a})}async updateComment(t,e,s,a,n="comment"){return this.makeRequestOnPosts("POST",`${t}/${e}/comments/${s}`,{comment:a,comment_type:n})}async deleteComment(t,e,s){return this.makeRequestOnPosts("DELETE",`${t}/${e}/comments/${s}`)}async getComments(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/comments`)}async toggle_comment_reaction(t,e,s,a,n){return this.makeRequestOnPosts("POST",`${t}/${e}/comments/${s}/react`,{user_id:a,reaction:n})}async getPostActivity(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/activity`)}async getSingleActivity(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/activity/${s}`)}async revertActivity(t,e,s){return this.makeRequestOnPosts("GET",`${t}/${e}/revert/${s}`)}async getPostShares(t,e){return this.makeRequestOnPosts("GET",`${t}/${e}/shares`)}async addPostShare(t,e,s){return this.makeRequestOnPosts("POST",`${t}/${e}/shares`,{user_id:s})}async removePostShare(t,e,s){return this.makeRequestOnPosts("DELETE",`${t}/${e}/shares`,{user_id:s})}async getFilters(){return this.makeRequest("GET","users/get_filters")}async saveFilters(t,e){return this.makeRequest("POST","users/save_filters",{filter:e,postType:t})}async deleteFilter(t,e){return this.makeRequest("DELETE","users/save_filters",{id:e,postType:t})}async searchUsers(t){return this.makeRequest("GET",`users/get_users?s=${t}`)}async createUser(t){return this.makeRequest("POST","users/create",t)}async advanced_search(t,e,s,a){return this.makeRequest("GET","advanced_search",{query:t,postType:e,offset:s,post:a.post,comment:a.comment,meta:a.meta,status:a.status},"dt-posts/v2/posts/search/")}}class s{constructor(t,s,a,n="wp-json"){this.postType=t,this.postId=s,this.nonce=a,this.apiRoot=`${n}/`.replace("//","/"),this.api=new e(this.nonce,this.apiRoot),this.autoSaveComponents=["dt-connection","dt-date","dt-location","dt-multi-select","dt-number","dt-single-select","dt-tags","dt-text","dt-textarea","dt-toggle","dt-comm-channel"],this.dynamicLoadComponents=["dt-connection","dt-tags"]}initialize(){this.postId&&this.enableAutoSave(),this.attachLoadEvents()}attachLoadEvents(t){const e=document.querySelectorAll(t||this.dynamicLoadComponents.join(","));e&&e.forEach((t=>t.addEventListener("load",this.handleLoadEvent.bind(this))))}enableAutoSave(t){const e=document.querySelectorAll(t||this.autoSaveComponents.join(","));e&&e.forEach((t=>t.addEventListener("change",this.handleChangeEvent.bind(this))))}async handleLoadEvent(t){const e=t.detail;if(e){const{field:s,query:a,onSuccess:n,onError:o}=e;try{const o=t.target.tagName.toLowerCase();let r=[];switch(o){case"dt-connection":{const t=e.postType||this.postType,s=await this.api.listPostsCompact(t,a);s?.posts&&(r=s?.posts.map((t=>({id:t.ID,label:t.name,link:t.permalink,status:t.status}))));break}default:r=await this.api.getMultiSelectValues(this.postType,s,a),r=r.map((t=>({id:t,label:t})))}n(r)}catch(t){o(t)}}}async handleChangeEvent(t){const e=t.detail;if(e){const{field:a,newValue:n}=e,o=t.target.tagName.toLowerCase(),r=s.convertValue(o,n);t.target.setAttribute("loading",!0);try{await this.api.updatePost(this.postType,this.postId,{[a]:r}),t.target.removeAttribute("loading"),t.target.setAttribute("saved",!0)}catch(e){console.error(e),t.target.removeAttribute("loading"),t.target.setAttribute("invalid",!0),t.target.setAttribute("error",e.message||e.toString())}}}static convertValue(t,e){let s=e;if(e)switch(t){case"dt-toggle":"string"==typeof e&&(s="true"===e.toLowerCase());break;case"dt-multi-select":"string"==typeof e&&(s=[e]),s={values:s.map((t=>{const e={value:t.replace("-","")};return t.startsWith("-")&&(e.delete=!0),e})),force_values:!1};break;case"dt-connection":case"dt-location":case"dt-tags":"string"==typeof e&&(s=[{id:e}]),s={values:s.map((t=>{const e={value:t.id};return t.delete&&(e.delete=t.delete),e})),force_values:!1};break;case"dt-comm-channel":"string"==typeof e&&(console.log("dt-comm-channel",e),s=[{id:e}])}return s}}return t.ApiService=e,t.ComponentService=s,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
